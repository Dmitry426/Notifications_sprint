# Notifications_Service


## Запуск проекта
Собираем и стартуем три `docker-compose` в папках:

- flask_app
```bash
docker-compose up --build -d
```
Поднимаются:
- Сервис авторизации - Задания 2, 4
- Хранилище на RabbitMQ - "Единое окно" - Задания 2-4
- Сервис уведомлений - Задания 2-4

###Структура проекта:
`Configs` - файлы настройки<br>
`architecture` - архитектурная схема<br>
`flask_app` - сервис Auth<br>
`templates` - шаблоны для писем<br>
`workers/messaging_workers` - консюмер для отправки Email,Websocket<br>
`workers/event_listeners` - слушатели отчетных событий<br>

<b>Договоренность:</b> админ-панель сервиса уведомлений, позволяющая отправлять отложенные
и регулярные уведомления, все данные для генерации писем передает через "Единое окно"
(В рамках проекта не было задачи реализации "админки").

<b>Тестирование:</b><br>
Запускаем `tester.py`. В хранилище загружаются фейковые данные для очередей:
- <b>регистрация пользователя:</b><br>- отправка пользователю письма с короткой ссылкой для подтверждения регистрации.
<br>- при переходе по ссылке пользователь попадает на страницу подтверждения регистрации
<br>- если ссылка актуальна ("не протухла"), в БД `Auth` обновляется статус на "подтвержден".
- <b>Вышла новая серия сериала:</b><br>-отправка пользователям персонифицированных писем со ссылкой новую серию.
- <b>Активность пользователя:</b><br>-устанавливается соединение по websocket
<br>- в `websocket` передается актуальный токен (для получения можно воспользоваться "ручкой" `Auth`).
<br>- в ответ передаются уведомления, актуальные для него, которых он еще не получал.
<br>- при появлении новых уведомлений об активности, данные передаются пользователю по `websocket`, если соединение не разорвано и если `access_token` пользователя актуален ("не протух").
<br>- если соединение разорвано, уведомления копятся в БД.
## Выполнено
### Задание 1: architecture.
Схема представлена в папке architecture.
- в формате pyml;
- в формате png;

### Задание 2:
- Реализуйте в своём сервисе модуль, отвечающий за генерацию и отправку персонализированных писем.
- Реализуйте модуль для работы с `Websocket`.

### Задание 3:
Технически требуется загрузить все письма в очередь на рассылку и полностью обработать её.

### Задание 4:
Реализуйте рассылку welcome-писем пользователям после регистрации в онлайн-кинотеатре. Welcome-письмо обычно содержит приветственное сообщение и инструкции, как подтвердить email, указанный при регистрации.

### Задание 5: CI.
